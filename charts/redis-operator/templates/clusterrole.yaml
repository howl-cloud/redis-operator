{{- if .Values.rbac.create -}}
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: {{ include "redis-operator.fullname" . }}-manager-role
  labels:
    {{- include "redis-operator.labels" . | nindent 4 }}
rules:
  # Core resources managed by the operator.
  - apiGroups: [""]
    resources: [pods]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [""]
    resources: [persistentvolumeclaims]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [""]
    resources: [services]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [""]
    resources: [configmaps]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [""]
    resources: [secrets]
    verbs: [get, list, watch, create, update, patch]
  - apiGroups: [""]
    resources: [serviceaccounts]
    verbs: [get, list, watch, create, update, patch]
  - apiGroups: [""]
    resources: [events]
    verbs: [create, patch]
  # PodDisruptionBudgets.
  - apiGroups: [policy]
    resources: [poddisruptionbudgets]
    verbs: [get, list, watch, create, update, patch, delete]
  # RBAC for per-cluster ServiceAccounts.
  - apiGroups: [rbac.authorization.k8s.io]
    resources: [roles, rolebindings]
    verbs: [get, list, watch, create, update, patch, delete]
  # Custom resources.
  - apiGroups: [redis.io]
    resources: [redisclusters]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [redis.io]
    resources: [redisclusters/status]
    verbs: [get, update, patch]
  - apiGroups: [redis.io]
    resources: [redisclusters/finalizers]
    verbs: [update]
  - apiGroups: [redis.io]
    resources: [redisbackups]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [redis.io]
    resources: [redisbackups/status]
    verbs: [get, update, patch]
  - apiGroups: [redis.io]
    resources: [redisbackups/finalizers]
    verbs: [update]
  - apiGroups: [redis.io]
    resources: [redisscheduledbackups]
    verbs: [get, list, watch, create, update, patch, delete]
  - apiGroups: [redis.io]
    resources: [redisscheduledbackups/status]
    verbs: [get, update, patch]
  - apiGroups: [redis.io]
    resources: [redisscheduledbackups/finalizers]
    verbs: [update]
  {{- if .Values.webhook.enabled }}
  # Webhook configuration management for self-managed PKI.
  - apiGroups: [admissionregistration.k8s.io]
    resources: [mutatingwebhookconfigurations, validatingwebhookconfigurations]
    verbs: [get, list, watch, update, patch]
  {{- end }}
{{- end }}
